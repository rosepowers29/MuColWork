import numpy as np
from array import array
import matplotlib.pyplot as plt
import mplhep as hep
import uproot
import ROOT
from matplotlib.ticker import (MultipleLocator, AutoMinorLocator)

#MAIA format python plots (!!)
###############RESO PLOT IN PAPER GENERATED WITH THE BELOW####################


#fit params
'''
p1B = 2.45e-05
p2B = 7.96
p3B = 0.00

p1nB = 0.216
p2nB = 0.00
p3nB = 0.00
'''
#fit params just transition region
'''
p1B = 0.773
p2B = 14.2
p3B = 0.0276

p1nB = 1.13
p2nB = 0.00
p3nB = 0.0176
'''

#for the new calib

p1nB = 1.15
p2nB = 0.0
p3nB = -1.28e-07

p1B = 6.76e-01
p2B = 1.96e+01
p3B = 4.73e-07


#fit params for just barrel
'''
p1B = 0.648
p2B = 8.54
p3B = 0.00108

p1nB = 0.559
p2nB = 0.00
p3nB = 2.21e-09
'''

#for the new calib:
'''
p1nB = 5.61e-01
p2nB = 0.0
p3nB = 2.01e-09

p1B = 1.91e-01
p2B = 1.35e+01
p3B = 1.37e-02
'''

#fit params for just endcap
'''
p1B = 0.214
p2B = 8.22
p3B = 0.00

p1nB = 0.184
p2nB = 0.00
p3nB = 0.00
'''

#for the new calibration:
'''
p1nB = 2.16e-01
p2nB = 0.00
p3nB = 0.00

p1B = 5.24e-02
p2B = 1.05e+01
p3B = 0.0
'''

#redefine the fit function
def py_resofit(stoch, noise, const, E):
    return np.sqrt((stoch**2)/E+(noise/E)**2+const**2)

Epoints = np.linspace(0.01,1000.,1000)
resopoints_B=[]
resopoints_nB = []

for energy in Epoints:
    resopoints_B.append(py_resofit(p1B,p2B,p3B, energy))
    resopoints_nB.append(py_resofit(p1nB, p2nB, p3nB, energy))

#define the arrays (generated with the fit)
#THETA (E>600 GeV)
#with BIB

th_arr_B = array('d', [0.22301724137931034, 0.31905172413793104, 0.41508620689655173, 0.5111206896551724, 0.6071551724137931, 0.7031896551724138, 0.7992241379310345, 0.8952586206896552, 0.9912931034482759, 1.0873275862068965, 1.1833620689655175, 1.2793965517241381, 1.3754310344827587, 1.4714655172413793, 1.5675000000000003, 1.663534482758621, 1.7595689655172415, 1.855603448275862, 1.9516379310344831, 2.0476724137931037, 2.1437068965517243, 2.239741379310345, 2.3357758620689655, 2.4318103448275865, 2.5278448275862067, 2.6238793103448277, 2.7199137931034483, 2.815948275862069, 2.91198275862069])


sigma_arr_B =array('d', [0.014985336126209045, 0.015259370634285898, 0.01311358305108972, 0.012637941710831277, 0.016449222277845225, 0.06937642513897613, 0.04904413843780907, 0.04223775538072993, 0.03976945210258776, 0.041182360271382924, 0.028235593462684793, 0.0221468618579374, 0.020889335723808192, 0.022713487702395625, 0.022120050151222606, 0.025325331380495635, 0.024052723359311665, 0.024312249451771597, 0.02932874789587409, 0.03126186751479265, 0.037435893002192376, 0.040374539696876204, 0.05866551850226964, 0.06765686683887726, 0.016794408824883013, 0.01286386426096478, 0.01334633551849141, 0.012482829437145957, 0.014963213021262795])

sigma_err_arr_B = array('d', [0.0007117232882891322, 0.0009716879109887971, 0.0007280055208369399, 0.000646510466755768, 0.0011275305845271436, 0.0038166807277270134, 0.0030972239607277054, 0.002127631891275683, 0.0028437165115473527, 0.0038816723552122477, 0.0016449323847294584, 0.0012082371846123437, 0.0010733907197227211, 0.001312809765072663, 0.001408961730506154, 0.0018007568568951526, 0.001430863691867245, 0.001316688887922829, 0.001362937395347331, 0.0021987998497175094, 0.0022663732414930013, 0.002206183346548811, 0.003955604010724947, 0.0035972412670660994, 0.0011118667582972943, 0.0007843608169701569, 0.0007181040834480608, 0.0006973028445296219, 0.0008802543602578951])


th_err_arr_B = array('d', [0.04801724137931035, 0.04801724137931035, 0.04801724137931035, 0.04801724137931038, 0.048017241379310294, 0.048017241379310405, 0.048017241379310294, 0.048017241379310405, 0.048017241379310294, 0.048017241379310405, 0.048017241379310405, 0.048017241379310294, 0.048017241379310294, 0.048017241379310405, 0.048017241379310405, 0.048017241379310294, 0.048017241379310294, 0.048017241379310405, 0.048017241379310405, 0.04801724137931018, 0.048017241379310294, 0.048017241379310516, 0.048017241379310294, 0.048017241379310294, 0.048017241379310294, 0.048017241379310294, 0.048017241379310516, 0.048017241379310294, 0.048017241379310294])


#no BIB
th_arr_nB = array('d', [0.22301724137931034, 0.31905172413793104, 0.41508620689655173, 0.5111206896551724, 0.6071551724137931, 0.7031896551724138, 0.7992241379310345, 0.8952586206896552, 0.9912931034482759, 1.0873275862068965, 1.1833620689655175, 1.2793965517241381, 1.3754310344827587, 1.4714655172413793, 1.5675000000000003, 1.663534482758621, 1.7595689655172415, 1.855603448275862, 1.9516379310344831, 2.0476724137931037, 2.1437068965517243, 2.239741379310345, 2.3357758620689655, 2.4318103448275865, 2.5278448275862067, 2.6238793103448277, 2.7199137931034483, 2.815948275862069, 2.91198275862069])


sigma_arr_nB = array('d', [0.00784238647657933, 0.008731218916314116, 0.008301619707196102, 0.01098515333056314, 0.011655631704189227, 0.0564774377162812, 0.04346223251762009, 0.03414813123258274, 0.029020963525735168, 0.024253108418222716, 0.02190587541831305, 0.018488772841736147, 0.01603442226885731, 0.015835016289208612, 0.015437867973055405, 0.016703809519291457, 0.01818248428468993, 0.018420193485915937, 0.022153803896705897, 0.026225292015490526, 0.02978563018831304, 0.03521810261285418, 0.04238406477340227, 0.05792455120314652, 0.012777713619969518, 0.008451439579575558, 0.008642533041362118, 0.0076144277043752595, 0.007715744010243736])

sigma_err_arr_nB = array('d', [0.00038431594082196947, 0.00029101591661986545, 0.0003010667959393396, 0.00020109250250382581, 0.0002067368439898883, 0.0007224704084769114, 0.0007683615645540168, 0.0005994379424628868, 0.0005282567222014145, 0.00039165661423578614, 0.00037304305572383525, 0.00033100686918215855, 0.00029630345852236367, 0.00027941367158260816, 0.0002546607303966575, 0.00028919109093022803, 0.0003223725648530268, 0.00037033507857554306, 0.0003764137535103608, 0.0005614928142040725, 0.0005852506171941038, 0.0006690934964906983, 0.0006243595285920223, 0.0008487362736416398, 0.0002314904925051391, 0.00023461089591495735, 0.0002497891729895049, 0.00041591490316724355, 0.0004093305623050652])

th_err_arr_nB = array('d', [0.04801724137931035, 0.04801724137931035, 0.04801724137931035, 0.04801724137931038, 0.048017241379310294, 0.048017241379310405, 0.048017241379310294, 0.048017241379310405, 0.048017241379310294, 0.048017241379310405, 0.048017241379310405, 0.048017241379310294, 0.048017241379310294, 0.048017241379310405, 0.048017241379310405, 0.048017241379310294, 0.048017241379310294, 0.048017241379310405, 0.048017241379310405, 0.04801724137931018, 0.048017241379310294, 0.048017241379310516, 0.048017241379310294, 0.048017241379310294, 0.048017241379310294, 0.048017241379310294, 0.048017241379310516, 0.048017241379310294, 0.048017241379310294])

#finegrain, barrel
'''
e_arr_B = array('d', [12.5, 17.5, 22.5, 27.5, 32.5, 37.5, 42.5, 47.5])
e_err_arr_B = array('d', [2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5])
sigma_arr_B = array('d', [0.804870353475822, 0.5034504356308986, 0.3112184418392616, 0.29120373624001133, 0.22175729470611236, 0.24699391981301316, 0.19896840275627334, 0.15923513635110423])
sigma_err_arr_B = array('d',  [0.10333480252776134, 0.04975268514309811, 0.03490151712084741, 0.018687230791797127, 0.01734151056129267, 0.026517722260353024, 0.02441427277360067, 0.011311382659140001])



e_arr_nB = array('d', [12.5, 17.5, 22.5, 27.5, 32.5, 37.5, 42.5, 47.5])
e_err_arr_nB = array('d', [2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5])
sigma_arr_nB = array('d',[0.13422389605390028, 0.11928952856594598, 0.10850850769610054, 0.10029063230953816, 0.09105502609053802, 0.08691280167996099, 0.08399870940450747, 0.07808494413152138])

sigma_err_arr_nB=array('d', [0.0025693366653904287, 0.0018371460978379855, 0.0016389772611454245, 0.0014002216830720504, 0.0011606037686362342, 0.001187424995036837, 0.0011861123843078733, 0.0011284370650040468])
'''
#FineGrain, endcaps
'''
e_arr_nB = array('d', [12.5, 17.5, 22.5, 27.5, 32.5, 37.5, 42.5, 47.5])
e_err_arr_nB = array('d', [2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5])
sigma_arr_nB = array('d', [0.050927007018643146, 0.04430496050768402, 0.038626585160039036, 0.03478510264085363, 0.03240985482452991, 0.03250328501062851, 0.02930795037852461, 0.02902476344469647])
sigma_err_arr_nB = array('d', [0.0008563740443471302, 0.0006947155153048147, 0.0006734088103457769, 0.0006539886701347371, 0.0005673778204113022, 0.0005838840040010909, 0.0004781016239498361, 0.00047097178596691193])


e_arr_B = array('d', [12.5, 17.5, 22.5, 27.5, 32.5, 37.5, 42.5, 47.5])
e_err_arr_B = array('d', [2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5])
sigma_arr_B = array('d', [0.6041052290061067, 0.5525780965097337, 0.3923846387878679, 0.3406276980044898, 0.29429597177042494, 0.25699118191041453, 0.2364130587553673, 0.2069687753975216])
sigma_err_arr_B = array('d', [0.03557108455080765, 0.02334928319271984, 0.022097537221631602, 0.016072693963660678, 0.01351485266642563, 0.014259167050229615, 0.012395522366945744, 0.009896993393491593])
'''

#FineGrain, central barrel
'''
e_arr_nB = array('d', [12.5, 17.5, 22.5, 27.5, 32.5, 37.5, 42.5, 47.5])
e_err_arr_nB = array('d', [2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5])
sigma_arr_nB = array('d', [0.158808941229739, 0.14242457369107517, 0.12796183973027073, 0.12001559549624065, 0.11104233647237698, 0.10391337467812699, 0.0979290243831676, 0.0960519772852796])
sigma_err_arr_nB = array('d', [0.0018301624950347178, 0.0016518988666634898, 0.001557574670130471, 0.0014126974929129232, 0.001316986993408223, 0.0012513697619266836, 0.0011789027008708985, 0.0012907027500942275])

e_arr_B = array('d', [12.5, 17.5, 22.5, 27.5, 32.5, 37.5, 42.5, 47.5])
e_err_arr_B = array('d', [2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5])
sigma_arr_B = array('d', [0.7302956109948894, 0.4585767158993229, 0.3727877478093142, 0.31930925851737463, 0.3094073775368462, 0.2813613729585491, 0.24804369225726047, 0.19822236435290658])
sigma_err_arr_B = array('d', [0.04440035218526622, 0.02243103358593901, 0.02004784484542277, 0.013639251114574452, 0.013680775266843082, 0.01385128832734478, 0.011816911867011254, 0.009269845642665475])
'''
#FineGrain, transition regions
'''
e_arr_nB = array('d', [12.5, 17.5, 22.5, 27.5, 32.5, 37.5, 42.5, 47.5])
e_err_arr_nB = array('d', [2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5])
sigma_arr_nB = array('d', [0.19820772173865836, 0.22103934839513956, 0.20248715834386208, 0.2024440678053787, 0.19263519528908096, 0.1831844689713017, 0.17779161909572977, 0.1771124889272018])
sigma_err_arr_nB = array('d', [0.002764051353911237, 0.003156025958476097, 0.0031236654436000155, 0.0031658880776131715, 0.0029670950331317086, 0.0030347928149955933, 0.002797138312064712, 0.0029853321353245227])


e_arr_B = array('d', [12.5, 17.5, 22.5, 27.5, 32.5, 37.5, 42.5, 47.5])
e_err_arr_B = array('d', [2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5])
sigma_arr_B = array('d', [0.6978745549814793, 0.5244205602534022, 0.4226919416842883, 0.4004206450567215, 0.3937516733900267, 0.30845311419054233, 0.33053662944289125, 0.28276046317354436])
sigma_err_arr_B = array('d', [0.05507536289311982, 0.02496618294657771, 0.02024942325554785, 0.017964080061944165, 0.020427116799848155, 0.012764167646141134, 0.014440988658673826, 0.012769621273906934])
'''

#With BIB overlay, dR < 0.1
#e_arr_B=array('d', [40.0, 75.0, 125.0, 175.0, 225.0, 275.0, 325.0, 375.0, 425.0, 475.0, 525.0, 575.0, 625.0, 675.0, 725.0, 775.0, 825.0, 875.0, 925.0, 975.0])

#endcaps
'''
sigma_arr_B= array('d', [0.31007633649912003, 0.1259033403295962, 0.07824023413319385, 0.055099551669105566, 0.04111527521673873, 0.029629044010660733, 0.028986374851902898, 0.023472718898690185, 0.022359674637235507, 0.017916723636377325, 0.01884775122240005, 0.016933181357844003, 0.014516954671462783, 0.013342561103333603, 0.014063785425101815, 0.014964857517570497, 0.01209304960006033, 0.011513752985066206, 0.012987017754769912, 0.010701420313895382])


sigma_err_arr_B = array('d',[0.007187854800500382, 0.00495534899453836, 0.0023563637769052695, 0.0017138035011120233, 0.0014425790972684219, 0.0020147862671344927, 0.001990455593587943, 0.0016492669923632765, 0.0011666282546244425, 0.0012066089697849846, 0.0010019427023397823, 0.0009534599221179933, 0.0007841520644783322, 0.0007137642720666604, 0.0007123770550540422, 0.0009228658487909569, 0.0008063105644295944, 0.0006795977504428768, 0.0006951669839871215, 0.0006166473499925312])
'''

#barrel
'''
sigma_arr_B = array('d', [0.3070429728095617, 0.14752370166397757, 0.08796626150377078, 0.07167525302825464, 0.053854485724718765, 0.048789478018061126, 0.04316043222987799, 0.04148226089512258, 0.041709831035905545, 0.03465818438206107, 0.02886398855383963, 0.031592500781162665, 0.03048072041067441, 0.028156697350413054, 0.028206580052691835, 0.025080420545775015, 0.02593157300003692, 0.022773386230234147, 0.022851819457184917, 0.023026106741691994])

sigma_err_arr_B = array('d', [0.009439157412631238, 0.0047216893520502096, 0.0028647294768809617, 0.0020502987650159316, 0.001696438012079457, 0.0025094717331558686, 0.002341093960636701, 0.002098556040762263, 0.0022851147339991544, 0.0018353212246244033, 0.0014495309663148694, 0.0014092401995797858, 0.0019379338714795597, 0.001470574970946591, 0.0013768521390450303, 0.0013503359752916125, 0.001463844573496513, 0.0013527287918863595, 0.00101510676352266, 0.0009708286547612556])
'''
#transition regions
'''
sigma_arr_B = array('d', [0.36621329706003947, 0.19586954568757475, 0.1371805126268942, 0.11185581877599376, 0.0811700846731315, 0.07605449109353524, 0.0646577939826317, 0.06660637918059882, 0.057492451383860284, 0.0503449890938679, 0.047018573336627824, 0.0477428216735883, 0.05805452828683992, 0.04782487239621923, 0.04914803523825539, 0.05092161916078047, 0.04265998246063796, 0.03681476411318727, 0.03889045394426011, 0.043685073150190726])

sigma_err_arr_B = array('d', [0.00853976506900933, 0.006335947445010245, 0.004473253643781622, 0.0038131825984768775, 0.004756409308504107, 0.009422817230815526, 0.005180184145716259, 0.006535642010019015, 0.004861673120131138, 0.00387394149847169, 0.0035337197383040267, 0.003960741327763789, 0.005611598264434508, 0.0037364602642860796, 0.003999234245090858, 0.0035163407658770317, 0.0030264039808220317, 0.002027430927633106, 0.00232061581403082, 0.002841721752377787])
'''

#e_err_arr_B = array('d', [10.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0])

#Without BIB overlay

#e_arr_nB = array('d', [40.0, 75.0, 125.0, 175.0, 225.0, 275.0, 325.0, 375.0, 425.0, 475.0, 525.0, 575.0, 625.0, 675.0, 725.0, 775.0, 825.0, 875.0, 925.0, 975.0])

#endcaps
'''
sigma_arr_nB = array('d',[0.034540023422273254, 0.020421427736204714, 0.015798046135557915, 0.013661427375403249, 0.011712945362586389, 0.01078367913963539, 0.0100998344454897, 0.009337817699182953, 0.008399152879527333, 0.008216853080971583, 0.007788865090067924, 0.007520357926586827, 0.007565532217308041, 0.0068316074190271124, 0.0067241299167281575, 0.006580477485058115, 0.006467047428477386, 0.006322404439789447, 0.006445277524203791, 0.005918403955438667])


sigma_err_arr_nB = array('d',[0.0002318017033739947, 0.0002212986729716905, 0.00017633052997292984, 0.00014378979553089904, 0.00011837878031859591, 0.00021876048973944705, 0.00019238142815620248, 0.00019387606512456627, 0.00015214352246972675, 0.00016554036086930714, 0.00015163795333204312, 0.0001296356683223236, 0.000139768720824661, 0.00013110445103384737, 0.00013673206860628784, 0.00011928196131254232, 0.00011440868412212731, 0.00011954833490055274, 0.00011810330721888926, 0.0001105359067323855])

#new calibration
'''
'''
sigma_arr_B = array('d', [0.33951006852998783, 0.26873876975003996, 0.0921905569628666, 0.05896126680610204, 0.04346994719236456, 0.037032527000448776, 0.031359547978802936, 0.032317496943054705, 0.02454259003242667, 0.02348875006362545, 0.019644291563838363, 0.016452837583388592, 0.015181819637071922, 0.014881845897130116, 0.014366774594506115, 0.011999183239276545, 0.013102682251671872, 0.012177818321754366, 0.012068356203460024, 0.012068349374728027])


sigma_err_arr_B = array('d', [0.012591694160725808, 0.008087756423700188, 0.0027193146781137947, 0.001751080385121978, 0.0016787840139780297, 0.0018351527097702214, 0.0014160057738065897, 0.0017394136775517252, 0.0012506877243293503, 0.0014132273606234959, 0.0010309399054286347, 0.0008841843154660965, 0.000851941370180985, 0.0007086488321914764, 0.0008107606713104593, 0.0007534265567632134, 0.0007777425943831726, 0.000463266689306149, 0.00045754266252200516, 0.00045754474926831996])


sigma_arr_nB = array('d', [0.055919917046881755, 0.041456501374926874, 0.026189725836487165, 0.018067750393311488, 0.014274059913167865, 0.015254428946700857, 0.01669378733246882, 0.016301505190251506, 0.014179813469386784, 0.014430146350277576, 0.012700838458676459, 0.009295011519715233, 0.009380391178076214, 0.008144677729255433, 0.0072936560453676896, 0.006751375569025704, 0.00653264920204721, 0.006415667687082068, 0.0062307999774783825, 0.006000977350153199])
sigma_err_arr_nB = array('d', [0.00036435511050868577, 0.00037156779538543433, 0.00024662048164644616, 0.00020469053954686074, 0.0001531374232645044, 0.00029593768438460587, 0.00032441214576632744, 0.0003890237328534815, 0.0002975191747344834, 0.00025654700370189576, 0.00023616147998970632, 0.00019992923164287562, 0.00019629369661560564, 0.00020098197799898673, 0.00014938969778964572, 0.00014468432203564724, 0.00013338556717978553, 8.723345385603211e-05, 6.966266697754075e-05, 5.724321325719555e-05])
'''
#barrel
'''
sigma_arr_nB = array('d', [0.11848470973569804, 0.06586672663523072, 0.054460453811232094, 0.04529554195289596, 0.03728268283240702, 0.033855133524753805, 0.030262967574800202, 0.030442652529048507, 0.027299598446048505, 0.026487517304907657, 0.02529131229472518, 0.023866178221688794, 0.02179812557924338, 0.021370519537114045, 0.020546635004925942, 0.02031626426287653, 0.018888785491084976, 0.01909749494846428, 0.018627229661076182, 0.017093482041843622])

sigma_err_arr_nB = array('d', [0.0005272615903351638, 0.0004962092138575958, 0.00044339875762648695, 0.0003740982963326353, 0.0003010334966719319, 0.0005370376557778736, 0.0004920744668415016, 0.000506419104162794, 0.0004762531206921189, 0.0004262121886970151, 0.00039927537754249655, 0.0003841070071347284, 0.0003244001917181178, 0.00034848795251355563, 0.0003415215182791236, 0.0002920243761337562, 0.0003296675681277259, 0.0003061344721840258, 0.00035067851736346814, 0.0002897745468929541])
'''
#new calibration
'''
sigma_arr_B = array('d', [0.30875404616308455, 0.25269511135845046, 0.0998949786016628, 0.071057585606584, 0.05343942109243684, 0.048994794815598396, 0.042052097089482605, 0.04351090868312603, 0.029765336099823025, 0.032786413146437134, 0.03145192209654104, 0.030714827909365628, 0.025722182555423335, 0.026368184410228035, 0.022431891365462968, 0.023103591400506194, 0.02190316077498252, 0.019963313356835446, 0.021037928413770123, 0.021037928413770123])

sigma_err_arr_B = array('d', [0.014463358024656758, 0.006162190335530504, 0.003005026900605806, 0.0017144826012162398, 0.0017554553109077609, 0.002507821612738735, 0.001911360908921144, 0.0017563560696513929, 0.0014825483357950933, 0.0016596083668995072, 0.0015798631722795126, 0.00205511463172711, 0.0012135286216920314, 0.001216469168848414, 0.0013406606115030934, 0.0012268276655671394, 0.0010612797140663443, 0.0006555836378622521, 0.0007371798770859951, 0.0007371798770859951])


sigma_arr_nB = array('d', [0.08950451151808575, 0.06584729094078201, 0.05074130827257735, 0.043260587954707476, 0.0355422753874691, 0.0359592102424966, 0.03189886099153551, 0.0332605198374305, 0.027278560337317185, 0.026603251707000657, 0.02463462088011236, 0.023576174924811448, 0.02175412024330357, 0.02181208269453389, 0.020293275035610358, 0.019944348112057447, 0.019402802496011153, 0.018899032659251122, 0.018458578560261386, 0.017608742838661262])

sigma_err_arr_nB =array('d', [0.0005779758171005553, 0.00044205794785216745, 0.000366768228373001, 0.0003232026612365879, 0.0002981743311072198, 0.0005624101297823092, 0.00048790287212175515, 0.00048288484309220656, 0.0004706622517806295, 0.0004245281763165312, 0.000380308964312754, 0.0003581969691976508, 0.0003283320392119451, 0.00035215786121562884, 0.00031593608437727877, 0.00031599606454825804, 0.00030068994268669415, 0.00021068755446986345, 0.00017034693853086244, 0.00014236992182624537])
'''


#transition region
'''
sigma_arr_nB = array('d', [0.2023224934303919, 0.13688259567707783, 0.10536297607801831, 0.09019640729065478, 0.07738120070076734, 0.06936201465941333, 0.06472893524590317, 0.061900972150398526, 0.058221760915190025, 0.05490873688551751, 0.051727670785784816, 0.05009577006125806, 0.048538374498179264, 0.04804428546994499, 0.04425537776345259, 0.04350080263995161, 0.04292565737057982, 0.04212208698414203, 0.0407121970871387, 0.04170240543252858])
sigma_err_arr_nB = array('d', [0.0010420035248632359, 0.0012924078406360562, 0.0010109179579060254, 0.0009096263396753124, 0.0008122177126246161, 0.0014010499949240612, 0.0012861672632806936, 0.0012312023478889093, 0.0012239200934719661, 0.0010915552320400097, 0.0009996144353148217, 0.001138007047250502, 0.0009715327139172836, 0.001076505426637439, 0.001036891673402776, 0.0009002977518607971, 0.000903372345208691, 0.000803247718965408, 0.0009139052380966774, 0.0008774066350191838])
'''
#new calibration
'''
sigma_arr_nB =array('d', [0.16009063507404223, 0.13490375674795566, 0.10354380064953844, 0.08115652809464237, 0.06468402505074838, 0.07455238951821506, 0.06486479151929984, 0.06268185881572494, 0.05883336579258819, 0.054674928185649126, 0.051628542725240166, 0.04993881347386618, 0.04613222793856127, 0.04733916905958336, 0.04372671930059625, 0.04438858614292562, 0.04071327908756608, 0.038912340932123396, 0.03624726195091037, 0.03354608464232848])

sigma_err_arr_nB = array('d', [0.001386095571655449, 0.0011267482969786607, 0.0009809586658927685, 0.0006784546783076828, 0.000710892672319198, 0.001377737609376234, 0.0012997094034608025, 0.0010676690015213215, 0.001242821643853264, 0.0010633361377677016, 0.000952099925470646, 0.0009907056460160407, 0.0009890914335391361, 0.001017802493210991, 0.000865573543807438, 0.0008812883694296857, 0.0007764646464342058, 0.00047215803350198274, 0.00037555875415246076, 0.00035682865303294023])

sigma_arr_B = array('d', [0.35406340519811846, 0.279119458163882, 0.13469677566729688, 0.09017630568669342, 0.08853594461669201, 0.08114662300348226, 0.06810025290582306, 0.0693319578170647, 0.053737907947805974, 0.05053070368418051, 0.04799528809626163, 0.049618236437350215, 0.042423299727370314, 0.04772851797689901, 0.04366107947001869, 0.037787731597420375, 0.03220550256253833, 0.02943122269563178, 0.029157254792434476, 0.029157254792434476])

sigma_err_arr_B = array('d', [0.010915201832151888, 0.007678081816600318, 0.003218368390181997, 0.002238083738946635, 0.0042220301570022045, 0.0036188982382414497, 0.002890679452577795, 0.003805076997835437, 0.00340713944457631, 0.0028840606623285366, 0.0024314259174895506, 0.0031664546149494134, 0.0025888171815484327, 0.003124107889231849, 0.0024425159838820237, 0.0018743645228215915, 0.0016667527537964667, 0.0012465072123415862, 0.001129065425563491, 0.001129065425563491])




e_err_arr_nB = array('d', [10.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0])
e_err_arr_B = e_err_arr_nB
'''
fig, ax = plt.subplots()
plt.errorbar(th_arr_B, sigma_arr_B, yerr = sigma_err_arr_B, xerr = th_err_arr_B, fmt=".", color='red', 
        label = "With BIB overlay")
plt.errorbar(th_arr_nB, sigma_arr_nB, yerr= sigma_err_arr_nB, xerr = th_err_arr_nB, fmt = ".", color = 'blue',
        label = "Without BIB overlay")
#plt.plot(Epoints, resopoints_B, '--', c='red',lw=0.25)#, label="Fit")
#plt.plot(Epoints, resopoints_nB, '--', c='blue',lw=0.25)
plt.ylim(0.0,0.1)
plt.xlim(0.175, 2.864)
plt.xlabel("True Photon $\\theta$ [rad]", loc='right')
plt.ylabel("Photon Energy Resolution $\sigma((E_{reco}-E_{true})/E_{true}$)", loc='top')
hep.cms.label(exp = "Muon Collider", data = False, label = 'with BIB (v0.4 Lattice) ', 
       rlabel='$MAIA$ Detector Concept', loc=2, italic=(1,0,0), pad=(0.0))
plt.gcf().text(0.16,0.74,"$\sqrt{s}=10$ TeV")
plt.gcf().text(0.16, 0.7, "True Photon Energy  > 600 GeV")
#plt.gcf().text(0.16,0.7,"Transition Region ($0.577<\\theta<1.0$ or $2.0<\\theta<2.56$)")
#plt.gcf().text(0.16, 0.7, "Central Barrel Region ($1.0<\\theta<2.0$)")
#plt.gcf().text(0.16,0.7, "Endcap Region ($\\theta < 0.577$ or $\\theta > 2.56$)")
#plt.gcf().text(0.65, 0.65, "$\\frac{\sigma}{E} = \sqrt{\\frac{p_0^2}{E}+\\frac{p_1^2}{E^2}+p_2^2}$")
#plt.gcf().text(0.65, 0.6, "Fit Results (no BIB):")
#plt.gcf().text(0.65, 0.55, "$p_0=$"+str(p1nB),color='blue')
#plt.gcf().text(0.65, 0.5, "$p_1=$"+str(p2nB), color='blue')
#plt.gcf().text(0.65, 0.45, "$p_2=$"+str(p3nB), color='blue')
#plt.gcf().text(0.65, 0.4, "Fit Results (with BIB):")
#plt.gcf().text(0.65, 0.35, "$p_0=$"+str(p1B),color='red')
#plt.gcf().text(0.65, 0.3, "$p_1=$"+str(p2B), color='red')
#plt.gcf().text(0.65, 0.25, "$p_2=$"+str(p3B), color='red')
ax.tick_params(bottom=True, top=True, left=True, right=True, which='both', direction='in')
ax.tick_params(labelbottom=True, labeltop=False, labelleft=True, labelright=False)
ax.tick_params(axis= 'y',which='major',length = 10)
ax.tick_params(axis='y',which='minor', length=5)

ax.xaxis.set_major_locator(MultipleLocator(0.5))
ax.xaxis.set_major_formatter('{x:.1f}')
ax.xaxis.set_minor_locator(MultipleLocator(0.1))

ax.yaxis.set_major_locator(MultipleLocator(0.025))
ax.yaxis.set_major_formatter('{x:.3f}')
ax.yaxis.set_minor_locator(MultipleLocator(0.005))

#plt.text(670,0.135, "MAIA", fontstyle = 'italic')
#plt.text(755, 0.135, "Detector Concept")
#plt.gcf().text(0.65,0.89, "MAIA", fontstyle='italic')
#plt.gcf().text(0.7,0.89, "Detector Concept")
#plt.text(670, 0.13, "BIB Overlay in [-0.5, 15] ns", fontsize = 'small')
plt.grid(axis = 'y', linestyle = ':')
plt.legend(loc='upper right',frameon=False)
plt.show()
plt.savefig("Ereso_recocalib_maia_Theta.pdf")
print("Ereso_recocalib_maia_Theta.pdf created")
plt.close()
